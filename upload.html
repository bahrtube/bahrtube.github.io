<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Загрузить видео - BAHRTUBE</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-left">
                <div class="menu-toggle">
                    <i class="fas fa-bars"></i>
                </div>
                <div class="logo" onclick="window.location.href='index.html'">
                    <i class="fab fa-youtube" style="color: #ff0000; margin-right: 8px;"></i>
                    <h1>BAHRTUBE</h1>
                </div>
            </div>
            <div class="search-bar">
                <input type="text" placeholder="Поиск видео...">
                <button><i class="fas fa-search"></i></button>
            </div>
            <div class="header-right">
                <div class="user-menu" id="user-menu"></div>
            </div>
        </header>

        <main class="upload-container">
            <div class="upload-header">
                <h1>Загрузить видео</h1>
                <p>Поделитесь видео с миром</p>
            </div>
            
            <div class="upload-form" id="upload-form">
                <div class="form-group">
                    <label for="video-url">Ссылка на YouTube видео</label>
                    <input type="text" id="video-url" placeholder="https://www.youtube.com/watch?v=...">
                    <small>Вставьте полную ссылку на YouTube видео</small>
                </div>
                
                <div class="form-group">
                    <label for="video-title">Название видео</label>
                    <input type="text" id="video-title" placeholder="Введите название">
                </div>
                
                <div class="form-group">
                    <label for="video-description">Описание</label>
                    <textarea id="video-description" rows="4" placeholder="Расскажите о вашем видео"></textarea>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="cancel-btn" onclick="window.location.href='index.html'">
                        Отмена
                    </button>
                    <button type="button" class="upload-submit-btn" id="upload-submit-btn">
                        Опубликовать
                    </button>
                </div>
            </div>
        </main>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const uploadBtn = document.getElementById('upload-submit-btn');
            
            if (uploadBtn) {
                uploadBtn.addEventListener('click', async () => {
                    if (!currentUser) {
                        alert('Для загрузки видео необходимо войти в аккаунт');
                        window.location.href = 'index.html';
                        return;
                    }
                    
                    const url = document.getElementById('video-url').value.trim();
                    const title = document.getElementById('video-title').value.trim();
                    const description = document.getElementById('video-description').value.trim();
                    
                    if (!url || !title) {
                        alert('Пожалуйста, заполните все обязательные поля');
                        return;
                    }
                    
                    const youTubeId = extractYouTubeId(url);
                    if (!youTubeId) {
                        alert('Некорректная ссылка на YouTube видео');
                        return;
                    }
                    
                    const videoData = {
                        url,
                        title,
                        description,
                        timestamp: Date.now()
                    };
                    
                    try {
                        const videoId = await db.addVideo(currentUser.uid, videoData);
                        alert('Видео успешно загружено!');
                        window.location.href = `video.html?id=${videoId}`;
                    } catch (error) {
                        console.error('Error uploading video:', error);
                        alert('Ошибка при загрузке видео');
                    }
                });
            }
        });
    </script>
</body>
</html>
