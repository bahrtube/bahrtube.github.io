<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BAHRTUBE</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-left">
                <div class="menu-toggle">
                    <i class="fas fa-bars"></i>
                </div>
                <div class="logo" onclick="window.location.href='index.html'">
                    <i class="fab fa-youtube" style="color: #ff0000; margin-right: 8px;"></i>
                    <h1>BAHRTUBE</h1>
                </div>
            </div>
            <div class="search-bar">
                <input type="text" placeholder="Поиск видео..." id="search-input">
                <button id="search-button"><i class="fas fa-search"></i></button>
            </div>
            <div class="header-right">
                <button class="mobile-search-btn" onclick="showMobileSearch()">
                    <i class="fas fa-search"></i>
                </button>
                <button class="upload-btn" onclick="goToUpload()">
                    <i class="fas fa-upload"></i> <span>Загрузить</span>
                </button>
                <button class="auth-btn" id="auth-btn">
                    <i class="fas fa-user"></i> <span>Войти</span>
                </button>
            </div>
        </header>

        <div class="main-content">
            <aside class="sidebar">
                <nav class="sidebar-nav">
                    <a href="index.html" class="nav-item">
                        <i class="fas fa-home"></i> Главная
                    </a>
                    <a href="#" class="nav-item" onclick="showNotification('Раздел "В тренде" в разработке', 'info')">
                        <i class="fas fa-fire"></i> В тренде
                    </a>
                    <a href="#" class="nav-item" onclick="showNotification('История просмотров в разработке', 'info')">
                        <i class="fas fa-history"></i> История
                    </a>
                    <div class="sidebar-divider"></div>
                    <h3 class="sidebar-title">Подписки</h3>
                    <div id="subscriptions-list">
                        <div class="subscription-item">
                            <div class="subscription-avatar">Т</div>
                            <span>ТехноБлог</span>
                        </div>
                        <div class="subscription-item">
                            <div class="subscription-avatar">И</div>
                            <span>Игровой Мир</span>
                        </div>
                    </div>
                </nav>
            </aside>

            <main class="video-page">
                <!-- Основной контент видео -->
                <div class="video-main-content">
                    <div class="video-player-container">
                        <!-- Кастомный видеоплеер -->
                        <div class="video-player-wrapper" id="video-player-wrapper">
                            <div class="video-loading" id="video-loading">
                                <i class="fas fa-spinner fa-spin" style="margin-right: 10px;"></i>
                                Загрузка плеера...
                            </div>
                            
                            <!-- Контейнер для YouTube iframe -->
                            <div id="youtube-iframe-container"></div>
                            
                            <!-- Кастомные элементы управления -->
                            <div class="custom-player-controls" id="custom-controls">
                                <div class="progress-bar-container" id="progress-bar-container">
                                    <div class="progress-bar" id="progress-bar"></div>
                                </div>
                                
                                <div class="controls-main">
                                    <div class="controls-left">
                                        <button class="custom-control-btn play-pause-btn" id="play-pause-btn">
                                            <i class="fas fa-play" id="play-icon"></i>
                                            <i class="fas fa-pause" id="pause-icon" style="display: none;"></i>
                                        </button>
                                        
                                        <button class="custom-control-btn volume-btn" id="volume-btn">
                                            <i class="fas fa-volume-up" id="volume-icon"></i>
                                        </button>
                                        
                                        <div class="volume-container" id="volume-container">
                                            <div class="volume-slider" id="volume-slider">
                                                <div class="volume-level" id="volume-level"></div>
                                            </div>
                                        </div>
                                        
                                        <div class="time-display" id="time-display">
                                            <span id="current-time">0:00</span> / <span id="total-time">0:00</span>
                                        </div>
                                    </div>
                                    
                                    <div class="controls-right">
                                        <button class="custom-control-btn speed-btn" id="speed-btn">
                                            <i class="fas fa-tachometer-alt"></i>
                                        </button>
                                        
                                        <button class="custom-control-btn quality-btn" id="quality-btn">
                                            <i class="fas fa-cog"></i>
                                        </button>
                                        
                                        <button class="custom-control-btn screenshot-btn" id="screenshot-btn">
                                            <i class="fas fa-camera"></i>
                                        </button>
                                        
                                        <button class="custom-control-btn fullscreen-btn" id="fullscreen-btn">
                                            <i class="fas fa-expand"></i>
                                            <i class="fas fa-compress" style="display: none;"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Меню скорости -->
                            <div class="speed-menu" id="speed-menu">
                                <div class="speed-option" data-speed="0.25">0.25x</div>
                                <div class="speed-option" data-speed="0.5">0.5x</div>
                                <div class="speed-option active" data-speed="1">1x (нормально)</div>
                                <div class="speed-option" data-speed="1.25">1.25x</div>
                                <div class="speed-option" data-speed="1.5">1.5x</div>
                                <div class="speed-option" data-speed="2">2x</div>
                            </div>
                            
                            <!-- Меню качества -->
                            <div class="quality-menu" id="quality-menu">
                                <div class="quality-option active" data-quality="auto">Авто</div>
                                <div class="quality-option" data-quality="144p">144p</div>
                                <div class="quality-option" data-quality="240p">240p</div>
                                <div class="quality-option" data-quality="360p">360p</div>
                                <div class="quality-option" data-quality="480p">480p</div>
                                <div class="quality-option" data-quality="720p">720p</div>
                                <div class="quality-option" data-quality="1080p">1080p</div>
                            </div>
                            
                            <!-- Оверлей для скриншота -->
                            <div class="video-overlay" id="screenshot-overlay">
                                <img class="screenshot-preview" id="screenshot-preview" alt="Скриншот">
                            </div>
                            
                            <!-- Уведомление о скриншоте -->
                            <div class="screenshot-notification" id="screenshot-notification">
                                Скриншот сохранен в буфер обмена
                            </div>
                        </div>
                        
                        <div class="video-info">
                            <h1 id="video-title">Название видео</h1>
                            <div class="video-meta">
                                <div class="video-stats">
                                    <span id="video-views">0 просмотров</span>
                                    <span id="video-date">Сегодня</span>
                                </div>
                                <div class="video-actions">
                                    <button class="video-action-btn" id="like-btn">
                                        <i class="far fa-thumbs-up"></i>
                                        <span id="like-count">0</span>
                                    </button>
                                    <button class="video-action-btn" id="dislike-btn">
                                        <i class="far fa-thumbs-down"></i>
                                        <span id="dislike-count">0</span>
                                    </button>
                                    <button class="video-action-btn" onclick="showNotification('Функция в разработке', 'info')">
                                        <i class="fas fa-share"></i> Поделиться
                                    </button>
                                    <button class="video-action-btn" onclick="showNotification('Функция в разработке', 'info')">
                                        <i class="fas fa-plus"></i> Сохранить
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="video-channel">
                            <div class="channel-info">
                                <div class="channel-avatar" id="channel-avatar">А</div>
                                <div class="channel-details">
                                    <h3 id="channel-name">Автор</h3>
                                    <span id="channel-subs">0 подписчиков</span>
                                </div>
                            </div>
                            <button class="subscribe-btn" id="subscribe-btn">
                                <i class="fas fa-bell"></i> Подписаться
                            </button>
                        </div>
                        
                        <div class="video-description">
                            <h3>Описание</h3>
                            <p id="video-description">Описание видео</p>
                        </div>
                    </div>
                </div>
                
                <!-- Боковая панель с рекомендациями -->
                <div class="recommendations-sidebar">
                    <h3>Рекомендации</h3>
                    <div class="recommendations-list" id="recommendations-list">
                        <!-- Рекомендации будут загружены через JavaScript -->
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- YouTube Player API -->
    <script src="https://www.youtube.com/iframe_api"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="script.js"></script>
    
    <script>
        // Кастомный видеоплеер
        class CustomVideoPlayer {
            constructor() {
                this.player = null;
                this.isPlaying = false;
                this.currentTime = 0;
                this.duration = 0;
                this.volume = 100;
                this.isMuted = false;
                this.playbackRate = 1;
                this.quality = 'auto';
                this.updateInterval = null;
                this.youTubeId = null;
                this.controlsTimeout = null;
                this.isFullscreen = false;
                
                this.init();
            }
            
            async init() {
                // Получаем ID видео из URL
                const urlParams = new URLSearchParams(window.location.search);
                const videoId = urlParams.get('id');
                
                if (!videoId) {
                    window.location.href = 'index.html';
                    return;
                }
                
                // Получаем информацию о видео из Firebase
                const videoInfo = await this.loadVideoInfo(videoId);
                
                if (!videoInfo) {
                    this.showError('Видео не найдено');
                    return;
                }
                
                // Извлекаем YouTube ID из ссылки
                this.youTubeId = this.extractYouTubeId(videoInfo.url);
                
                if (!this.youTubeId) {
                    this.showError('Неверная ссылка на YouTube');
                    return;
                }
                
                // Инициализируем YouTube Player API
                this.initYouTubePlayer();
                
                // Настраиваем обработчики событий
                this.setupEventListeners();
            }
            
            extractYouTubeId(url) {
                const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
                const match = url.match(regExp);
                return (match && match[2].length === 11) ? match[2] : null;
            }
            
            async loadVideoInfo(videoId) {
                try {
                    const video = await db.getVideo(videoId);
                    
                    if (!video) {
                        window.location.href = 'index.html';
                        return null;
                    }
                    
                    // Сохраняем currentVideoId для лайков/дизлайков
                    window.currentVideoId = videoId;
                    
                    document.getElementById('video-title').textContent = video.title || 'Без названия';
                    document.getElementById('video-views').textContent = formatNumber(video.views || 0) + ' просмотров';
                    document.getElementById('video-date').textContent = formatDate(video.timestamp);
                    document.getElementById('like-count').textContent = formatNumber(video.likes || 0);
                    document.getElementById('dislike-count').textContent = formatNumber(video.dislikes || 0);
                    document.getElementById('channel-name').textContent = video.channelName || 'Автор';
                    document.getElementById('channel-subs').textContent = formatNumber(video.subscribers || 0) + ' подписчиков';
                    document.getElementById('channel-avatar').textContent = video.channelAvatar || (video.channelName || 'А').charAt(0);
                    document.getElementById('video-description').textContent = video.description || 'Нет описания';
                    
                    // Увеличиваем просмотры
                    await db.updateVideo(videoId, { views: (video.views || 0) + 1 });
                    
                    // Загружаем рекомендации
                    loadRecommendations(videoId);
                    
                    return video;
                    
                } catch (error) {
                    console.error('Error loading video info:', error);
                    return null;
                }
            }
            
            initYouTubePlayer() {
                // Проверяем, загружена ли уже YouTube API
                if (window.YT && window.YT.Player) {
                    this.createPlayer();
                } else {
                    // Если API еще не загружен, ждем события
                    window.onYouTubeIframeAPIReady = () => {
                        this.createPlayer();
                    };
                    
                    // На всякий случай, если событие уже произошло
                    setTimeout(() => {
                        if (window.YT && window.YT.Player && !this.player) {
                            this.createPlayer();
                        }
                    }, 1000);
                }
            }
            
            createPlayer() {
                try {
                    console.log('Creating YouTube player with ID:', this.youTubeId);
                    
                    this.player = new YT.Player('youtube-iframe-container', {
                        height: '100%',
                        width: '100%',
                        videoId: this.youTubeId,
                        playerVars: {
                            'autoplay': 1,
                            'controls': 0,
                            'disablekb': 1,
                            'fs': 0,
                            'modestbranding': 1,
                            'rel': 0,
                            'showinfo': 0,
                            'iv_load_policy': 3
                        },
                        events: {
                            'onReady': (event) => this.onPlayerReady(event),
                            'onStateChange': (event) => this.onPlayerStateChange(event),
                            'onError': (event) => this.onPlayerError(event)
                        }
                    });
                    
                } catch (error) {
                    console.error('Error creating YouTube player:', error);
                    this.showError('Ошибка загрузки плеера');
                }
            }
            
            onPlayerReady(event) {
                console.log('YouTube player ready');
                this.duration = event.target.getDuration();
                this.updateTotalTime();
                this.setVolume(this.volume);
                
                // Скрываем индикатор загрузки
                document.getElementById('video-loading').style.display = 'none';
                
                // Запускаем обновление времени
                this.startUpdateInterval();
                
                // Устанавливаем таймаут для скрытия контролов
                this.resetControlsTimeout();
                
                // Инициализируем взаимодействия (лайки и т.д.)
                this.setupVideoInteractions();
            }
            
            onPlayerStateChange(event) {
                console.log('Player state changed:', event.data);
                switch(event.data) {
                    case YT.PlayerState.PLAYING:
                        this.isPlaying = true;
                        this.updatePlayPauseButton();
                        this.resetControlsTimeout();
                        break;
                    case YT.PlayerState.PAUSED:
                        this.isPlaying = false;
                        this.updatePlayPauseButton();
                        break;
                    case YT.PlayerState.ENDED:
                        this.isPlaying = false;
                        this.updatePlayPauseButton();
                        break;
                    case YT.PlayerState.BUFFERING:
                        console.log('Buffering...');
                        break;
                    case YT.PlayerState.CUED:
                        console.log('Video cued');
                        break;
                }
            }
            
            onPlayerError(event) {
                console.error('YouTube player error:', event.data);
                let errorMessage = 'Ошибка загрузки видео';
                
                switch(event.data) {
                    case 2:
                        errorMessage = 'Неверный YouTube ID';
                        break;
                    case 5:
                        errorMessage = 'Ошибка HTML5 плеера';
                        break;
                    case 100:
                        errorMessage = 'Видео не найдено';
                        break;
                    case 101:
                    case 150:
                        errorMessage = 'Владелец запретил встраивание';
                        break;
                }
                
                this.showError(errorMessage);
            }
            
            showError(message) {
                document.getElementById('video-loading').innerHTML = `
                    <div style="text-align: center; color: #f44336;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 48px; margin-bottom: 16px;"></i>
                        <h3 style="margin-bottom: 12px;">${message}</h3>
                        <button onclick="window.history.back()" style="padding: 10px 20px; background-color: #2E7D32; color: white; border: none; border-radius: 8px; cursor: pointer;">
                            Назад
                        </button>
                    </div>
                `;
            }
            
            setupEventListeners() {
                const playerWrapper = document.getElementById('video-player-wrapper');
                
                // Кнопка play/pause
                document.getElementById('play-pause-btn').addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.togglePlayPause();
                    this.resetControlsTimeout();
                });
                
                // Прогресс бар
                const progressBar = document.getElementById('progress-bar-container');
                progressBar.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const rect = progressBar.getBoundingClientRect();
                    const percent = (e.clientX - rect.left) / rect.width;
                    this.seekTo(percent * this.duration);
                    this.resetControlsTimeout();
                });
                
                // Громкость
                document.getElementById('volume-btn').addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.toggleMute();
                    this.resetControlsTimeout();
                });
                
                const volumeSlider = document.getElementById('volume-slider');
                volumeSlider.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const rect = volumeSlider.getBoundingClientRect();
                    const percent = (e.clientX - rect.left) / rect.width;
                    this.setVolume(percent * 100);
                    this.resetControlsTimeout();
                });
                
                // Полноэкранный режим
                document.getElementById('fullscreen-btn').addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.toggleFullscreen();
                    this.resetControlsTimeout();
                });
                
                // Скорость воспроизведения
                document.getElementById('speed-btn').addEventListener('click', (e) => {
                    e.stopPropagation();
                    const menu = document.getElementById('speed-menu');
                    menu.classList.toggle('show');
                    this.resetControlsTimeout();
                });
                
                document.querySelectorAll('.speed-option').forEach(option => {
                    option.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const speed = parseFloat(e.target.dataset.speed);
                        this.setPlaybackRate(speed);
                        
                        // Обновляем активный элемент
                        document.querySelectorAll('.speed-option').forEach(opt => {
                            opt.classList.remove('active');
                        });
                        e.target.classList.add('active');
                        
                        // Закрываем меню
                        document.getElementById('speed-menu').classList.remove('show');
                        this.resetControlsTimeout();
                    });
                });
                
                // Качество
                document.getElementById('quality-btn').addEventListener('click', (e) => {
                    e.stopPropagation();
                    const menu = document.getElementById('quality-menu');
                    menu.classList.toggle('show');
                    this.resetControlsTimeout();
                });
                
                // Скриншот
                document.getElementById('screenshot-btn').addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.takeScreenshot();
                    this.resetControlsTimeout();
                });
                
                // Закрытие меню при клике вне их
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('#speed-btn') && !e.target.closest('#speed-menu')) {
                        document.getElementById('speed-menu').classList.remove('show');
                    }
                    if (!e.target.closest('#quality-btn') && !e.target.closest('#quality-menu')) {
                        document.getElementById('quality-menu').classList.remove('show');
                    }
                    
                    // Сброс таймаута контролов при любом клике на плеере
                    if (e.target.closest('#video-player-wrapper')) {
                        this.resetControlsTimeout();
                    }
                });
                
                // Управление с клавиатуры
                document.addEventListener('keydown', (e) => {
                    // Проверяем, что фокус не в поле ввода
                    if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
                    
                    switch(e.key) {
                        case ' ':
                        case 'k':
                            e.preventDefault();
                            this.togglePlayPause();
                            this.resetControlsTimeout();
                            break;
                        case 'f':
                            e.preventDefault();
                            this.toggleFullscreen();
                            this.resetControlsTimeout();
                            break;
                        case 'm':
                            e.preventDefault();
                            this.toggleMute();
                            this.resetControlsTimeout();
                            break;
                        case 'ArrowLeft':
                            e.preventDefault();
                            this.seekTo(this.currentTime - 5);
                            this.resetControlsTimeout();
                            break;
                        case 'ArrowRight':
                            e.preventDefault();
                            this.seekTo(this.currentTime + 5);
                            this.resetControlsTimeout();
                            break;
                        case 'ArrowUp':
                            e.preventDefault();
                            this.setVolume(Math.min(this.volume + 10, 100));
                            this.resetControlsTimeout();
                            break;
                        case 'ArrowDown':
                            e.preventDefault();
                            this.setVolume(Math.max(this.volume - 10, 0));
                            this.resetControlsTimeout();
                            break;
                    }
                });
                
                // Анимация элементов управления при наведении
                playerWrapper.addEventListener('mouseenter', () => {
                    this.showControls();
                });
                
                playerWrapper.addEventListener('mouseleave', () => {
                    // Не скрываем сразу, даем время пользователю
                    if (this.isPlaying) {
                        this.resetControlsTimeout();
                    }
                });
                
                playerWrapper.addEventListener('mousemove', () => {
                    this.showControls();
                    this.resetControlsTimeout();
                });
                
                // Обработка полноэкранного режима
                document.addEventListener('fullscreenchange', () => {
                    this.isFullscreen = !!document.fullscreenElement;
                });
                
                document.addEventListener('webkitfullscreenchange', () => {
                    this.isFullscreen = !!document.webkitFullscreenElement;
                });
            }
            
            setupVideoInteractions() {
                // Инициализация лайков/дизлайков/подписок
                if (typeof setupVideoInteractions === 'function') {
                    setupVideoInteractions();
                }
            }
            
            startUpdateInterval() {
                this.updateInterval = setInterval(() => {
                    if (this.player && this.player.getCurrentTime) {
                        this.currentTime = this.player.getCurrentTime();
                        this.updateProgressBar();
                        this.updateCurrentTime();
                    }
                }, 100);
            }
            
            resetControlsTimeout() {
                if (this.controlsTimeout) {
                    clearTimeout(this.controlsTimeout);
                }
                
                // Показываем контролы
                this.showControls();
                
                // Устанавливаем таймаут для скрытия (только если видео играет и не в полноэкранном режиме)
                if (this.isPlaying) {
                    this.controlsTimeout = setTimeout(() => {
                        if (this.isPlaying) {
                            this.hideControls();
                        }
                    }, 3000);
                }
            }
            
            showControls() {
                const controls = document.getElementById('custom-controls');
                if (controls) {
                    controls.style.opacity = '1';
                    controls.style.transform = 'translateY(0)';
                }
            }
            
            hideControls() {
                const controls = document.getElementById('custom-controls');
                if (controls && this.isPlaying) {
                    controls.style.opacity = this.isFullscreen ? '0.1' : '0.3';
                    controls.style.transform = this.isFullscreen ? 'translateY(10px)' : 'translateY(0)';
                }
            }
            
            updateProgressBar() {
                if (this.duration > 0) {
                    const progressPercent = (this.currentTime / this.duration) * 100;
                    document.getElementById('progress-bar').style.width = `${progressPercent}%`;
                }
            }
            
            updateCurrentTime() {
                const currentTimeFormatted = this.formatTime(this.currentTime);
                document.getElementById('current-time').textContent = currentTimeFormatted;
            }
            
            updateTotalTime() {
                const totalTimeFormatted = this.formatTime(this.duration);
                document.getElementById('total-time').textContent = totalTimeFormatted;
            }
            
            updatePlayPauseButton() {
                const playIcon = document.getElementById('play-icon');
                const pauseIcon = document.getElementById('pause-icon');
                
                if (this.isPlaying) {
                    playIcon.style.display = 'none';
                    pauseIcon.style.display = 'block';
                } else {
                    playIcon.style.display = 'block';
                    pauseIcon.style.display = 'none';
                }
            }
            
            togglePlayPause() {
                if (!this.player) return;
                
                if (this.isPlaying) {
                    this.player.pauseVideo();
                } else {
                    this.player.playVideo();
                }
            }
            
            seekTo(time) {
                if (!this.player) return;
                
                this.player.seekTo(time, true);
                this.currentTime = time;
                this.updateProgressBar();
                this.updateCurrentTime();
            }
            
            setVolume(volume) {
                if (!this.player) return;
                
                this.volume = Math.max(0, Math.min(100, volume));
                this.player.setVolume(this.volume);
                
                // Размутить если был выключен звук
                if (this.isMuted && this.volume > 0) {
                    this.player.unMute();
                    this.isMuted = false;
                }
                
                this.updateVolumeUI();
            }
            
            toggleMute() {
                if (!this.player) return;
                
                if (this.isMuted) {
                    this.player.unMute();
                    this.isMuted = false;
                } else {
                    this.player.mute();
                    this.isMuted = true;
                }
                this.updateVolumeUI();
            }
            
            updateVolumeUI() {
                const volumeLevel = document.getElementById('volume-level');
                const volumeIcon = document.getElementById('volume-icon');
                
                if (volumeLevel) {
                    volumeLevel.style.width = `${this.volume}%`;
                }
                
                if (volumeIcon) {
                    // Обновляем иконку громкости
                    if (this.isMuted || this.volume === 0) {
                        volumeIcon.className = 'fas fa-volume-mute';
                    } else if (this.volume < 50) {
                        volumeIcon.className = 'fas fa-volume-down';
                    } else {
                        volumeIcon.className = 'fas fa-volume-up';
                    }
                }
            }
            
            setPlaybackRate(rate) {
                if (!this.player) return;
                
                this.playbackRate = rate;
                this.player.setPlaybackRate(rate);
            }
            
            toggleFullscreen() {
                const wrapper = document.getElementById('video-player-wrapper');
                
                if (!document.fullscreenElement) {
                    if (wrapper.requestFullscreen) {
                        wrapper.requestFullscreen();
                    } else if (wrapper.webkitRequestFullscreen) {
                        wrapper.webkitRequestFullscreen();
                    } else if (wrapper.msRequestFullscreen) {
                        wrapper.msRequestFullscreen();
                    }
                    wrapper.classList.add('fullscreen');
                    this.isFullscreen = true;
                } else {
                    if (document.exitFullscreen) {
                        document.exitFullscreen();
                    } else if (document.webkitExitFullscreen) {
                        document.webkitExitFullscreen();
                    } else if (document.msExitFullscreen) {
                        document.msExitFullscreen();
                    }
                    wrapper.classList.remove('fullscreen');
                    this.isFullscreen = false;
                }
            }
            
            takeScreenshot() {
                // Не реализовано из-за CORS политики YouTube
                this.showScreenshotNotification();
            }
            
            showScreenshotNotification() {
                const notification = document.getElementById('screenshot-notification');
                notification.style.display = 'block';
                
                setTimeout(() => {
                    notification.style.display = 'none';
                }, 3000);
            }
            
            formatTime(seconds) {
                const hours = Math.floor(seconds / 3600);
                const minutes = Math.floor((seconds % 3600) / 60);
                const secs = Math.floor(seconds % 60);
                
                if (hours > 0) {
                    return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                } else {
                    return `${minutes}:${secs.toString().padStart(2, '0')}`;
                }
            }
        }

        // Инициализация при загрузке страницы
        document.addEventListener('DOMContentLoaded', function() {
            // Скрываем sidebar на мобильных
            if (window.innerWidth <= 768) {
                const sidebar = document.querySelector('.sidebar');
                const mainContent = document.querySelector('.main-content');
                if (sidebar) sidebar.classList.add('closed');
                if (mainContent) mainContent.classList.add('sidebar-hidden');
            }
            
            // Инициализируем кастомный видеоплеер
            window.videoPlayer = new CustomVideoPlayer();
        });
    </script>
</body>
</html>
